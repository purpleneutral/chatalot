<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Chatalot</title>
<style>
	* { margin: 0; padding: 0; box-sizing: border-box; }
	html, body { width: 100%; height: 100%; overflow: hidden; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #1a1a2e; color: #e0e0e0; }
	#connect-form { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; gap: 16px; padding: 24px; }
	#connect-form h1 { font-size: 24px; font-weight: 600; margin-bottom: 8px; }
	#connect-form p { font-size: 14px; color: #a0a0b0; max-width: 360px; text-align: center; }
	#connect-form input { width: 100%; max-width: 360px; padding: 10px 14px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); color: #e0e0e0; font-size: 14px; outline: none; }
	#connect-form input:focus { border-color: #6c5ce7; }
	#connect-form button { width: 100%; max-width: 360px; padding: 10px 14px; border-radius: 8px; border: none; background: #6c5ce7; color: white; font-size: 14px; font-weight: 500; cursor: pointer; }
	#connect-form button:hover { background: #5b4bd5; }
	#connect-form button:disabled { opacity: 0.5; cursor: not-allowed; }
	#connect-error { color: #ff6b6b; font-size: 13px; max-width: 360px; text-align: center; min-height: 20px; }
</style>
</head>
<body>
<div id="connect-form">
	<h1>Chatalot</h1>
	<p>Enter the URL of your Chatalot server to connect.</p>
	<input id="server-input" type="url" placeholder="https://chat.example.com" autocomplete="url" />
	<div id="connect-error"></div>
	<button id="connect-btn" type="button">Connect</button>
</div>

<script>
(function() {
	var STORAGE_KEY = 'chatalot_server_url';
	var form = document.getElementById('connect-form');
	var input = document.getElementById('server-input');
	var btn = document.getElementById('connect-btn');
	var errorEl = document.getElementById('connect-error');
	var serverUrl = localStorage.getItem(STORAGE_KEY);

	function handleConnect() {
		errorEl.textContent = '';
		var url = input.value.trim().replace(/\/+$/, '');
		if (!url) { errorEl.textContent = 'Please enter a server URL.'; return; }
		if (!/^https?:\/\//i.test(url)) url = 'https://' + url;
		btn.disabled = true;
		btn.textContent = 'Connecting...';

		fetch(url + '/api/auth/config', { mode: 'cors' })
			.then(function(resp) {
				if (!resp.ok) throw new Error('Server returned ' + resp.status);
				return resp.json();
			})
			.then(function(data) {
				if (!data.registration_mode) throw new Error('Not a Chatalot server');
				localStorage.setItem(STORAGE_KEY, url);
				window.location.href = url;
			})
			.catch(function(err) {
				errorEl.textContent = 'Could not reach server: ' + (err.message || err);
				btn.disabled = false;
				btn.textContent = 'Connect';
			});
	}

	if (serverUrl) {
		window.location.href = serverUrl;
	} else {
		btn.addEventListener('click', handleConnect);
		input.addEventListener('keydown', function(e) {
			if (e.key === 'Enter') handleConnect();
		});
	}
})();
</script>
</body>
</html>
